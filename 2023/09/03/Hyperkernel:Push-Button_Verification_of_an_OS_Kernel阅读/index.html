<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf8"/>
    <meta name="viewport" content="initial-scale=1.0, width=device-width"/>
    <title>
      
        Hyperkernel: Push-Button Verification of an OS Kernel 阅读 | ZPF.SITE
      
    </title>
    <meta name="description" content=""/>
    <meta name="keywords" content=""/>
    
      <link rel="apple-touch-icon"
            sizes="180x180"
            href="/images/apple-touch-icon.png"/>
    
    
      <link rel="icon"
            type="image/png"
            sizes="32x32"
            href="/images/favicon-32x32.png"/>
    
    
      <link rel="icon"
            type="image/png"
            sizes="16x16"
            href="/images/favicon-16x16.png"/>
    
    
      <link rel="mask-icon"
            href="/images/logo.svg"
            color=""/>
    
    
    
      
  <style>
    @font-face {
        font-family:sourceHanSerif;
        src: url(/font/regular.ttf);
        font-weight: regular;
    }
  </style>

  <style>
    @font-face {
        font-family:sourceHanSerif;
        src: url(/font/bold.ttf);
        font-weight: bold;
    }
  </style>


    
    <link rel="stylesheet"
          type="text/css"
          href='/css/layout.css'/>
    
    
  <link rel="stylesheet" type="text/css" href="/css/post.css" />
  

  <meta name="generator" content="Hexo 6.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>
  <body>
    <div class="head">
      <div class="nav">
        <a href='/' class="nav-logo">
          <img alt="logo" height="60px" width="60px" src="/images/logo.svg"/>
        </a>
        <input id="navBtn" type="checkbox"/>
        <div class="nav-menu">
          
            
              <a class="nav-menu-item" href="/CS&Maths">Computer Science & Maths</a>
            
              <a class="nav-menu-item" href="/Life">Life</a>
            
          
          
        </div>
        <label class="nav-btn" for="navBtn"></label>
      </div>
    </div>
    <div class="body">
      
  <article class="post-content">
    <div class="post-inner--toc">
      <div class="post-content__head">
        <div class="post-title">Hyperkernel: Push-Button Verification of an OS Kernel 阅读</div>
        <div class="post-info">
          
  <a href="/tags/Paper/" class="post-tag">#Paper</a><a href="/tags/Symbolic-Execution/" class="post-tag">#Symbolic Execution</a><a href="/tags/Staitc-Analysis/" class="post-tag">#Staitc Analysis</a><a href="/tags/SOSP/" class="post-tag">#SOSP</a><a href="/tags/xv6/" class="post-tag">#xv6</a><a href="/tags/SOSP-17/" class="post-tag">#SOSP'17</a>


          <span class="post-date">2023-09-03</span>
        </div>
      </div>
      
        <aside class="toc-outer">
          <div class="toc-title">目录</div>
          <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#hyperkernel-%E9%AA%8C%E8%AF%81%E9%9D%A2%E4%B8%B4%E7%9A%84%E6%8C%91%E6%88%98%E4%B8%8E%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95"><span class="post-toc-text">Hyperkernel 验证面临的挑战与解决办法</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%8C%91%E6%88%98%E4%B8%80"><span class="post-toc-text">挑战一</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%8C%91%E6%88%98%E4%BA%8C"><span class="post-toc-text">挑战二</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%8C%91%E6%88%98%E4%B8%89"><span class="post-toc-text">挑战三</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%8C%91%E6%88%98%E5%9B%9B"><span class="post-toc-text">挑战四</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%8C%91%E6%88%98%E4%BA%94"><span class="post-toc-text">挑战五</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%8A%BD%E8%B1%A1%E5%86%85%E6%A0%B8%E7%8A%B6%E6%80%81"><span class="post-toc-text">抽象内核状态</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E7%8A%B6%E6%80%81%E6%9C%BA%E8%A7%84%E8%8C%83"><span class="post-toc-text">状态机规范</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%A3%B0%E6%98%8E%E5%BC%8F%E8%A7%84%E8%8C%83"><span class="post-toc-text">声明式规范</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%8C%91%E6%88%98%E5%85%AD"><span class="post-toc-text">挑战六</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E8%A7%84%E8%8C%83"><span class="post-toc-text">规范</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E9%AA%8C%E8%AF%81"><span class="post-toc-text">验证</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#theorem-1-refinement"><span class="post-toc-text">Theorem 1: REFINEMENT</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#theorem-2-crosscutting"><span class="post-toc-text">Theorem 2: CROSSCUTTING</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E9%AA%8C%E8%AF%81%E5%A4%B1%E8%B4%A5"><span class="post-toc-text">验证失败</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E9%AA%8C%E8%AF%81%E5%99%A8"><span class="post-toc-text">验证器</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%80%BB%E7%BB%93"><span class="post-toc-text">总结</span></a></li></ol>
          <a href="#" class="toc-top">回到顶部</a>
        </aside>
      
      <div class="post-content__body">
        
          <div class="post-gallery">
            
          </div>
        
        <p>修改xv6的内核接口，构建状态机规范和声明式规范以支持SMT（Satisfiability Modulo Theories）求解器来进行验证。通过有限化内核接口，使用硬件虚拟化简化虚拟内存推理，并在LLVM IR级别工作，以避免对C语义进行建模，从而实现了"一键验证"。 <span id="more"></span></p>
<p>程序员使用Python编写两种规范来指定系统调用的期望行为：详细的<strong>状态机规范</strong>和更高级的<strong>声明式规范</strong>。两种规范都用Python表达，并使用Z3 SMT求解器进行验证。程序员使用C实现系统调用。验证器将Python规范和C编译成的LLVM IR实现转化为SMT查询，并调用Z3进行验证。验证后的代码与未验证的（可信任的）代码链接，生成最终的内核映像。</p>
<p><img src="/Hyperkernel:Push-Button_Verification_of_an_OS_Kernel阅读/image1.png" width="550"></p>
<h2 id="hyperkernel-验证面临的挑战与解决办法">Hyperkernel 验证面临的挑战与解决办法</h2>
<h3 id="挑战一">挑战一</h3>
<p>内核接口的设计需要在可用性和自动化验证之间取得平衡。内核需要提供丰富的抽象来保证用户程序的正确性，但接口也必须容易实现并验证。</p>
<p><strong>解决办法</strong>：设计了有限的内核接口，避免了无界的循环和递归。</p>
<blockquote>
<p>在Unix设计中，每个进程都有一个文件描述符表，每个槽位都指向系统范围内的文件表。文件表维护每个条目的引用计数器，以正确管理资源。</p>
<p><code>dup(oldfd)</code>的 POSIX 语义是“创建<code>oldfd</code>的副本，使用<strong><em>最小</em></strong>未使用的文件描述符作为新描述符”。例如，在进程<code>j</code>中调用<code>dup(0)</code>将返回FD 1，引用文件表条目 4，并将该条目的引用计数增加到 3。 <img src="/Hyperkernel:Push-Button_Verification_of_an_OS_Kernel阅读/image2.png" width="500"> <code>dup</code>接口的POSIX语义是非有限的。因为最小FD需要内核检查每个小于新选择的FD的slot是否已经被占用。因此，分配最小FD需要一个随着FD表大小增长的跟踪，即跟踪长度不能被一个独立于系统参数的小常数所限制。缺乏有限界意味着<code>dup</code>的验证时间会随着FD表的大小增加而增加。</p>
<p>Hyperkernel通过将POSIX接口改为<code>dup(oldfd, newfd)</code>来进行有限化处理，这要求<strong>用户空间</strong>选择一个新的FD值。为了实现这个接口，内核只需检查给定的<code>newfd</code>是否未使用。这个检查只需要<code>O(1)</code>，与FD表的大小无关。因此，该接口是有限的，可以进行可扩展的验证，避免了路径爆炸。</p>
</blockquote>
<h3 id="挑战二">挑战二</h3>
<p>由于内核和用户空间共享一个虚拟地址空间，需要处理内核代码中虚拟地址到物理地址的转换，增加了验证难度。在验证中同时处理中断、并发和外设I/O也是一个大挑战。</p>
<p><strong>解决办法</strong>：</p>
<blockquote>
<p>内核在禁用中断的情况下执行陷阱处理程序，直到返回用户空间（再次陷入内核）之前，中断被推迟。通过这样做，每个陷阱处理程序都在内核中完整运行。</p>
<p>使用硬件虚拟化技术给内核和用户空间分配独立的页表，内核使用恒等映射简化了虚拟地址管理。</p>
<p>内核通过将DMA限制在专用内存区域来隔离设备对内存的异步修改，从而实现对其影响的隔离。这一机制的实现是通过 Intel 的 VT-d Protected Memory Regions 或 AMD 的 Device Exclusion Vector 来实现的。</p>
</blockquote>
<h3 id="挑战三">挑战三</h3>
<p>内核使用C语言实现，而C语言中像指针算术和内存访问这样的低级操作，以及未定义行为，会使形式化验证变得非常困难。</p>
<p><strong>解决办法</strong>：在LLVM IR而不是C源代码级别进行验证，减少了对C语言语义的建模。</p>
<h3 id="挑战四">挑战四</h3>
<p>许多POSIX系统调用如fork和mmap的语义都是非有限的，不易用SMT表达式表示和验证。</p>
<p><strong>解决办法</strong>：将复杂系统调用像fork/exec分解为多个细粒度的原语系统调用。只在内核实现这些原语系统调用，确保隔离性。复杂逻辑在用户态实现。</p>
<h3 id="挑战五">挑战五</h3>
<p>保证规范的正确性，避免规范本身存在bug也不容易。</p>
<p><strong>解决办法</strong>：提出了两级规范，通过一致性检查增强对规范的信心。</p>
<blockquote>
<p>程序员通过提供一个<strong>状态机规范</strong>来描述内核的期望行为，该规范包括<strong>抽象内核状态</strong>的定义以及基于抽象状态转换的陷阱处理程序（例如系统调用）的定义。除了状态机规范，程序员还可以选择提供高级属性的<strong>声明式规范</strong>，以确保状态机规范满足这些高级属性。Hyperkernel验证器将检查这些高级属性是否确实满足，从而增加程序员对状态机规范正确性的信心。</p>
<h4 id="抽象内核状态">抽象内核状态</h4>
<p>使用固定宽度整数和映射来定义抽象内核状态： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractKernelState</span>(<span class="hljs-title class_ inherited__">object</span>):<br>  current = PidT()<br>  proc_fd_table = Map((PidT, FdT), FileT)<br>  proc_nr_fds = RefcntMap(PidT, SizeT)<br>  file_nr_fds = RefcntMap(FileT, SizeT)<br>  ...<br></code></pre></td></tr></table></figure> <code>current</code> 表示当前运行的进程的 PID；<br> <code>proc_fd_table</code> 表示每个进程的文件描述符表，将 PID 和 FD 映射到文件；<br> <code>proc_nr_fds</code> 映射进程的 PID 到该进程使用的文件描述符数量；<br> <code>file_nr_fds</code> 映射文件到所有进程引用该文件的文件描述符总数量。</p>
<h4 id="状态机规范">状态机规范</h4>
<p>系统调用的规范通常遵循一个模式：验证系统调用参数，如果验证通过，则将内核转换到下一个状态并返回零；否则，系统调用返回错误代码，内核状态不会改变。每个系统调用规范都提供验证条件和新状态，以<code>dup</code>为例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">spec_dup</span>(<span class="hljs-params">state, oldfd, newfd</span>):<br>  <span class="hljs-comment"># state is an instance of AbstractKernelState </span><br>  pid = state.current<br>  <span class="hljs-comment"># validation condition for system call arguments </span><br>  valid = And(<br>    <span class="hljs-comment"># oldfd is in [0, NR_FDS)</span><br>    oldfd &gt;= <span class="hljs-number">0</span>, oldfd &lt; NR_FDS,<br>    <span class="hljs-comment"># oldfd refers to an open file</span><br>    state.proc_fd_table(pid, oldfd) &lt; NR_FILES,<br>    <span class="hljs-comment"># newfd is in [0, NR_FDS)</span><br>    newfd &gt;= <span class="hljs-number">0</span>, newfd &lt; NR_FDS,<br>    <span class="hljs-comment"># newfd does not refer to an open file</span><br>    state.proc_fd_table(pid, newfd) &gt;= NR_FILES, <br>  )<br>  <span class="hljs-comment"># make the new state based on the current state</span><br>  new_state = state.copy()<br>  f = state.proc_fd_table(pid, oldfd)<br>  <span class="hljs-comment"># newfd refers to the same file as oldfd </span><br>  new_state.proc_fd_table[pid, newfd] = f<br>  <span class="hljs-comment"># bump the FD counter for the current process </span><br>  new_state.proc_nr_fds(pid).inc(newfd)<br>  <span class="hljs-comment"># bump the counter in the file table </span><br>  new_state.file_nr_fds(f).inc(pid, newfd)<br>  <span class="hljs-keyword">return</span> valid, new_state<br></code></pre></td></tr></table></figure>
<p>正常情况下还有spec中错误代码，但此处省略了。</p>
<h4 id="声明式规范">声明式规范</h4>
<p>状态机规范是一个抽象的规范，不包含C语言中的未定义行为，也不涉及实现细节，比如内存中的数据布局。但是在编写状态机规范时，程序员仍然需要注意一些细节，比如在指定<code>dup</code>时正确修改文件表中的引用计数。为了提高对状态机规范正确性的信心，还开发了一个更高级的声明式规范，这个规范以一系列交叉属性的合取形式呈现，这些属性适用于所有陷阱处理程序。</p>
<p>考虑 high-level 的文件表中的引用计数正确性属性：如果文件的引用计数为零，则不能有任何文件描述符指向该文件。(high-level 我理解是跳出了单个 interface 的范围，普遍适用的规范，all trap handlers should follow the property)</p>
<p>声明如下： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">ForAll([f, pid, fd], Implies(file_nr_fds(f) == <span class="hljs-number">0</span>, proc_fd_table(pid, fd) != f))<br></code></pre></td></tr></table></figure> 上述仅关注于引用计数为零时不能有指向其的文件描述符。更一般的，每个陷阱处理程序都应该维护一个文件的引用计数，该计数等于引用该文件的每个进程文件描述符的总数。 <span class="math display"><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="52.782ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 23329.4 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mtable"><g data-mml-node="mtr"><g data-mml-node="mtd"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="66" d="M273 0Q255 3 146 3Q43 3 34 0H26V46H42Q70 46 91 49Q99 52 103 60Q104 62 104 224V385H33V431H104V497L105 564L107 574Q126 639 171 668T266 704Q267 704 275 704T289 705Q330 702 351 679T372 627Q372 604 358 590T321 576T284 590T270 627Q270 647 288 667H284Q280 668 273 668Q245 668 223 647T189 592Q183 572 182 497V431H293V385H185V225Q185 63 186 61T189 57T194 54T199 51T206 49T213 48T222 47T231 47T241 46T251 46H282V0H273Z"></path></g><g data-mml-node="mi" transform="translate(372,0)"><path data-c="69" d="M69 609Q69 637 87 653T131 669Q154 667 171 652T188 609Q188 579 171 564T129 549Q104 549 87 564T69 609ZM247 0Q232 3 143 3Q132 3 106 3T56 1L34 0H26V46H42Q70 46 91 49Q100 53 102 60T104 102V205V293Q104 345 102 359T88 378Q74 385 41 385H30V408Q30 431 32 431L42 432Q52 433 70 434T106 436Q123 437 142 438T171 441T182 442H185V62Q190 52 197 50T232 46H255V0H247Z"></path></g><g data-mml-node="mi" transform="translate(650,0)"><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"></path></g><g data-mml-node="mi" transform="translate(928,0)"><path data-c="65" d="M28 218Q28 273 48 318T98 391T163 433T229 448Q282 448 320 430T378 380T406 316T415 245Q415 238 408 231H126V216Q126 68 226 36Q246 30 270 30Q312 30 342 62Q359 79 369 104L379 128Q382 131 395 131H398Q415 131 415 121Q415 117 412 108Q393 53 349 21T250 -11Q155 -11 92 58T28 218ZM333 275Q322 403 238 411H236Q228 411 220 410T195 402T166 381T143 340T127 274V267H333V275Z"></path></g><g data-mml-node="mi" transform="translate(1372,0)"><path data-c="5F" d="M0 -62V-25H499V-62H0Z"></path></g><g data-mml-node="mi" transform="translate(1872,0)"><path data-c="6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z"></path></g><g data-mml-node="mi" transform="translate(2428,0)"><path data-c="72" d="M36 46H50Q89 46 97 60V68Q97 77 97 91T98 122T98 161T98 203Q98 234 98 269T98 328L97 351Q94 370 83 376T38 385H20V408Q20 431 22 431L32 432Q42 433 60 434T96 436Q112 437 131 438T160 441T171 442H174V373Q213 441 271 441H277Q322 441 343 419T364 373Q364 352 351 337T313 322Q288 322 276 338T263 372Q263 381 265 388T270 400T273 405Q271 407 250 401Q234 393 226 386Q179 341 179 207V154Q179 141 179 127T179 101T180 81T180 66V61Q181 59 183 57T188 54T193 51T200 49T207 48T216 47T225 47T235 46T245 46H276V0H267Q249 3 140 3Q37 3 28 0H20V46H36Z"></path></g><g data-mml-node="mi" transform="translate(2820,0)"><path data-c="5F" d="M0 -62V-25H499V-62H0Z"></path></g><g data-mml-node="mi" transform="translate(3320,0)"><path data-c="66" d="M273 0Q255 3 146 3Q43 3 34 0H26V46H42Q70 46 91 49Q99 52 103 60Q104 62 104 224V385H33V431H104V497L105 564L107 574Q126 639 171 668T266 704Q267 704 275 704T289 705Q330 702 351 679T372 627Q372 604 358 590T321 576T284 590T270 627Q270 647 288 667H284Q280 668 273 668Q245 668 223 647T189 592Q183 572 182 497V431H293V385H185V225Q185 63 186 61T189 57T194 54T199 51T206 49T213 48T222 47T231 47T241 46T251 46H282V0H273Z"></path></g><g data-mml-node="mi" transform="translate(3692,0)"><path data-c="64" d="M376 495Q376 511 376 535T377 568Q377 613 367 624T316 637H298V660Q298 683 300 683L310 684Q320 685 339 686T376 688Q393 689 413 690T443 693T454 694H457V390Q457 84 458 81Q461 61 472 55T517 46H535V0Q533 0 459 -5T380 -11H373V44L365 37Q307 -11 235 -11Q158 -11 96 50T34 215Q34 315 97 378T244 442Q319 442 376 393V495ZM373 342Q328 405 260 405Q211 405 173 369Q146 341 139 305T131 211Q131 155 138 120T173 59Q203 26 251 26Q322 26 373 103V342Z"></path></g><g data-mml-node="mi" transform="translate(4248,0)"><path data-c="73" d="M295 316Q295 356 268 385T190 414Q154 414 128 401Q98 382 98 349Q97 344 98 336T114 312T157 287Q175 282 201 278T245 269T277 256Q294 248 310 236T342 195T359 133Q359 71 321 31T198 -10H190Q138 -10 94 26L86 19L77 10Q71 4 65 -1L54 -11H46H42Q39 -11 33 -5V74V132Q33 153 35 157T45 162H54Q66 162 70 158T75 146T82 119T101 77Q136 26 198 26Q295 26 295 104Q295 133 277 151Q257 175 194 187T111 210Q75 227 54 256T33 318Q33 357 50 384T93 424T143 442T187 447H198Q238 447 268 432L283 424L292 431Q302 440 314 448H322H326Q329 448 335 442V310L329 304H301Q295 310 295 316Z"></path></g></g><g data-mml-node="mo" transform="translate(4642,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(5031,0)"><path data-c="1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"></path></g><g data-mml-node="mo" transform="translate(5581,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(6247.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mo" transform="translate(7303.6,0) translate(0 -0.5)"><path data-c="7C" d="M139 -249H137Q125 -249 119 -235V251L120 737Q130 750 139 750Q152 750 159 735V-235Q151 -249 141 -249H139Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(7581.6,0)"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(389,0)"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mi" transform="translate(892,0)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1237,0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g><g data-mml-node="mo" transform="translate(1757,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(2201.7,0)"><path data-c="1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"></path></g><g data-mml-node="mi" transform="translate(2751.7,0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g><g data-mml-node="mo" transform="translate(3271.7,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(3660.7,0) translate(0 -0.5)"><path data-c="7C" d="M139 -249H137Q125 -249 119 -235V251L120 737Q130 750 139 750Q152 750 159 735V-235Q151 -249 141 -249H139Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(3938.7,0)"><g data-mml-node="mi"><path data-c="70" d="M36 -148H50Q89 -148 97 -134V-126Q97 -119 97 -107T97 -77T98 -38T98 6T98 55T98 106Q98 140 98 177T98 243T98 296T97 335T97 351Q94 370 83 376T38 385H20V408Q20 431 22 431L32 432Q42 433 61 434T98 436Q115 437 135 438T165 441T176 442H179V416L180 390L188 397Q247 441 326 441Q407 441 464 377T522 216Q522 115 457 52T310 -11Q242 -11 190 33L182 40V-45V-101Q182 -128 184 -134T195 -145Q216 -148 244 -148H260V-194H252L228 -193Q205 -192 178 -192T140 -191Q37 -191 28 -194H20V-148H36ZM424 218Q424 292 390 347T305 402Q234 402 182 337V98Q222 26 294 26Q345 26 384 80T424 218Z"></path></g><g data-mml-node="mi" transform="translate(556,0)"><path data-c="72" d="M36 46H50Q89 46 97 60V68Q97 77 97 91T98 122T98 161T98 203Q98 234 98 269T98 328L97 351Q94 370 83 376T38 385H20V408Q20 431 22 431L32 432Q42 433 60 434T96 436Q112 437 131 438T160 441T171 442H174V373Q213 441 271 441H277Q322 441 343 419T364 373Q364 352 351 337T313 322Q288 322 276 338T263 372Q263 381 265 388T270 400T273 405Q271 407 250 401Q234 393 226 386Q179 341 179 207V154Q179 141 179 127T179 101T180 81T180 66V61Q181 59 183 57T188 54T193 51T200 49T207 48T216 47T225 47T235 46T245 46H276V0H267Q249 3 140 3Q37 3 28 0H20V46H36Z"></path></g><g data-mml-node="mi" transform="translate(948,0)"><path data-c="6F" d="M28 214Q28 309 93 378T250 448Q340 448 405 380T471 215Q471 120 407 55T250 -10Q153 -10 91 57T28 214ZM250 30Q372 30 372 193V225V250Q372 272 371 288T364 326T348 362T317 390T268 410Q263 411 252 411Q222 411 195 399Q152 377 139 338T126 246V226Q126 130 145 91Q177 30 250 30Z"></path></g><g data-mml-node="mi" transform="translate(1448,0)"><path data-c="63" d="M370 305T349 305T313 320T297 358Q297 381 312 396Q317 401 317 402T307 404Q281 408 258 408Q209 408 178 376Q131 329 131 219Q131 137 162 90Q203 29 272 29Q313 29 338 55T374 117Q376 125 379 127T395 129H409Q415 123 415 120Q415 116 411 104T395 71T366 33T318 2T249 -11Q163 -11 99 53T34 214Q34 318 99 383T250 448T370 421T404 357Q404 334 387 320Z"></path></g><g data-mml-node="mi" transform="translate(1892,0)"><path data-c="5F" d="M0 -62V-25H499V-62H0Z"></path></g><g data-mml-node="mi" transform="translate(2392,0)"><path data-c="66" d="M273 0Q255 3 146 3Q43 3 34 0H26V46H42Q70 46 91 49Q99 52 103 60Q104 62 104 224V385H33V431H104V497L105 564L107 574Q126 639 171 668T266 704Q267 704 275 704T289 705Q330 702 351 679T372 627Q372 604 358 590T321 576T284 590T270 627Q270 647 288 667H284Q280 668 273 668Q245 668 223 647T189 592Q183 572 182 497V431H293V385H185V225Q185 63 186 61T189 57T194 54T199 51T206 49T213 48T222 47T231 47T241 46T251 46H282V0H273Z"></path></g><g data-mml-node="mi" transform="translate(2764,0)"><path data-c="64" d="M376 495Q376 511 376 535T377 568Q377 613 367 624T316 637H298V660Q298 683 300 683L310 684Q320 685 339 686T376 688Q393 689 413 690T443 693T454 694H457V390Q457 84 458 81Q461 61 472 55T517 46H535V0Q533 0 459 -5T380 -11H373V44L365 37Q307 -11 235 -11Q158 -11 96 50T34 215Q34 315 97 378T244 442Q319 442 376 393V495ZM373 342Q328 405 260 405Q211 405 173 369Q146 341 139 305T131 211Q131 155 138 120T173 59Q203 26 251 26Q322 26 373 103V342Z"></path></g><g data-mml-node="mi" transform="translate(3320,0)"><path data-c="5F" d="M0 -62V-25H499V-62H0Z"></path></g><g data-mml-node="mi" transform="translate(3820,0)"><path data-c="74" d="M27 422Q80 426 109 478T141 600V615H181V431H316V385H181V241Q182 116 182 100T189 68Q203 29 238 29Q282 29 292 100Q293 108 293 146V181H333V146V134Q333 57 291 17Q264 -10 221 -10Q187 -10 162 2T124 33T105 68T98 100Q97 107 97 248V385H18V422H27Z"></path></g><g data-mml-node="mi" transform="translate(4209,0)"><path data-c="61" d="M137 305T115 305T78 320T63 359Q63 394 97 421T218 448Q291 448 336 416T396 340Q401 326 401 309T402 194V124Q402 76 407 58T428 40Q443 40 448 56T453 109V145H493V106Q492 66 490 59Q481 29 455 12T400 -6T353 12T329 54V58L327 55Q325 52 322 49T314 40T302 29T287 17T269 6T247 -2T221 -8T190 -11Q130 -11 82 20T34 107Q34 128 41 147T68 188T116 225T194 253T304 268H318V290Q318 324 312 340Q290 411 215 411Q197 411 181 410T156 406T148 403Q170 388 170 359Q170 334 154 320ZM126 106Q126 75 150 51T209 26Q247 26 276 49T315 109Q317 116 318 175Q318 233 317 233Q309 233 296 232T251 223T193 203T147 166T126 106Z"></path></g><g data-mml-node="mi" transform="translate(4709,0)"><path data-c="62" d="M307 -11Q234 -11 168 55L158 37Q156 34 153 28T147 17T143 10L138 1L118 0H98V298Q98 599 97 603Q94 622 83 628T38 637H20V660Q20 683 22 683L32 684Q42 685 61 686T98 688Q115 689 135 690T165 693T176 694H179V543Q179 391 180 391L183 394Q186 397 192 401T207 411T228 421T254 431T286 439T323 442Q401 442 461 379T522 216Q522 115 458 52T307 -11ZM182 98Q182 97 187 90T196 79T206 67T218 55T233 44T250 35T271 29T295 26Q330 26 363 46T412 113Q424 148 424 212Q424 287 412 323Q385 405 300 405Q270 405 239 390T188 347L182 339V98Z"></path></g><g data-mml-node="mi" transform="translate(5265,0)"><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"></path></g><g data-mml-node="mi" transform="translate(5543,0)"><path data-c="65" d="M28 218Q28 273 48 318T98 391T163 433T229 448Q282 448 320 430T378 380T406 316T415 245Q415 238 408 231H126V216Q126 68 226 36Q246 30 270 30Q312 30 342 62Q359 79 369 104L379 128Q382 131 395 131H398Q415 131 415 121Q415 117 412 108Q393 53 349 21T250 -11Q155 -11 92 58T28 218ZM333 275Q322 403 238 411H236Q228 411 220 410T195 402T166 381T143 340T127 274V267H333V275Z"></path></g></g><g data-mml-node="mo" transform="translate(9925.7,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(10314.7,0)"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mi" transform="translate(10817.7,0)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(11162.7,0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g><g data-mml-node="mo" transform="translate(11682.7,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(12127.3,0)"><path data-c="1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"></path></g><g data-mml-node="mi" transform="translate(12677.3,0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g><g data-mml-node="mo" transform="translate(13197.3,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(13864.1,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(14919.9,0)"><path data-c="1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"></path></g></g><g data-mml-node="mo" transform="translate(23051.4,0) translate(0 -0.5)"><path data-c="7C" d="M139 -249H137Q125 -249 119 -235V251L120 737Q130 750 139 750Q152 750 159 735V-235Q151 -249 141 -249H139Z"></path></g></g></g></g></g></g></svg></mjx-container></span></p>
<p>对于引用计数，即使状态机规范和实现都无法正确更新引用计数器，声明式规范也会暴露出错误。</p>
</blockquote>
<h3 id="挑战六">挑战六</h3>
<p>验证不能覆盖内核的全部代码，例如内核中的表示不变量（representation invariant）。</p>
<p><strong>解决办法</strong>：</p>
<blockquote>
<p>内核会显式地检查来自用户空间的值（例如系统调用参数），因为这些值是不受信任的。但通常情况下，内核内部的值的有效性是隐式假设的。例如，考虑全局变量 <code>current</code>，它存储了当前运行进程的PID。<code>dup</code> 系统调用的实现使用 <code>current</code> 来索引 <code>procs</code> 数组。为了检查（而不是假设）此访问不会导致缓冲区溢出，Hyperkernel 有两个选择：动态检查或静态检查。</p>
<p><strong>动态检查</strong>在 <code>dup</code>（以及使用 <code>current</code> 的其他系统调用）中插入以下代码进行测试：<br>
<code>if (current &gt; 0 &amp;&amp; current &lt; NR_PROCS) { ... }</code><br>
缺点是会增加内核的大小并浪费 CPU 时间。</p>
<p><strong>静态检查</strong>是在验证时进行检查。程序员编写了与 <code>current</code> 的相同范围检查，但在一个特殊的 <code>check_rep_invariant()</code> 函数中，该函数描述了内核数据结构的表示不变性。验证器将尝试证明每个陷阱处理程序都维护表示不变性。</p>
</blockquote>
<h2 id="规范">规范</h2>
<blockquote>
<p>使用SMT求解器的优点是，如果验证失败，它能够生成一个测试用例，有助于定位和修复错误。验证器会生成一个具体的测试用例，包括内核状态和系统调用参数，以描述如何触发错误。如果两者之间存在不一致，验证器会显示违规情况。</p>
</blockquote>
<h2 id="验证">验证</h2>
<p>Hyperkernel的验证主要证明了两个定理： <img src="/Hyperkernel:Push-Button_Verification_of_an_OS_Kernel阅读/image3.png" width="600"></p>
<h3 id="theorem-1-refinement">Theorem 1: REFINEMENT</h3>
<p>验证器会对每个陷阱处理程序：</p>
<ol type="1">
<li>将内核的 C 实现编译成 LLVM IR；</li>
<li>程序员提供的等价约束，关联实现和规范，例如：<br>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">llvm_global('<span class="hljs-title">@current</span>') <span class="hljs-operator">=</span><span class="hljs-operator">=</span> state.current<br></code></pre></td></tr></table></figure> 左侧辅助函数 <code>llvm_global</code> 在 LLVM IR 中查找一个名为 <code>current</code> 的符号（<code>@</code> 表示 LLVM 中的全局符号），右侧表示抽象状态中的当前 PID；</li>
<li>符号执行 IR，翻译成 SMT 表达式；</li>
<li>将 Python 编写的状态机规范翻译成 SMT 表达式；</li>
<li>将上述输入送给 Z3，检查它们是否在每个状态转换中同步移动来证明是否满足定理1。</li>
</ol>
<h3 id="theorem-2-crosscutting">Theorem 2: CROSSCUTTING</h3>
<p>验证器将Python编写的状态机规范和声明规范转换为SMT，并在每个状态转换后检查声明规范是否成立，以证明定理2的正确性。</p>
<h3 id="验证失败">验证失败</h3>
<p>如果验证器无法证明两个定理，它可以发现以下两类错误：</p>
<ol type="1">
<li>在实现中的错误：未定义行为或违反状态机规范的错误。</li>
<li>在状态机规范中的错误：违反声明式规范的错误。</li>
</ol>
<p>在这些情况下，验证器会尝试从 Z3 反例中生成具体的测试用例，以帮助调试问题。例如，如果程序员忘记验证 <code>dup</code> 中的系统调用参数 <code>oldfd</code>，验证器会输出一个堆栈跟踪，以及导致 FD 表中越界访问的具体 <code>oldfd</code> 值。</p>
<p>另一个例子是，如果程序员忘记在 <code>dup</code> 实现中增加文件表中的引用计数，验证器会突出显示在状态机规范中被违反的子句，并提供一个简化的解释。这个解释描述了在系统调用之前和之后的内核状态以及规范的状态。通常情况下，规范和实现在系统调用之前是等价的，但是在系统调用之后，规范中的计数器已经正确更新，而实现中的计数器保持不变，这破坏了等价性，因此证明失败。</p>
<p><img src="/Hyperkernel:Push-Button_Verification_of_an_OS_Kernel阅读/image4.png" width="600"></p>
<p>这个输出表明，在进程PID 32中调用<code>dupfd(1, 0)</code>会触发一个bug。系统调用之前的内核状态是：PID 32是当前运行的进程；它的FD 1指向文件1（引用计数为1）；其他FD和文件表项为空。两个<code>ForAll</code>语句分别突出了系统调用之前和之后的有问题的状态。在调用之前，规范和实现状态是等价的。在系统调用之后，规范中的计数器被正确更新（即文件1的计数器<code>file_nr_fds</code>增加了1）；然而，在实现中计数器保持不变（即<code>@files-&gt;struct.file::refcnt</code>），这破坏了等价函数，因此证明失败。</p>
<p>文中提到的两个定理在 Z3 无法找到任何反例时成立。 定理1保证已验证的内核实现部分没有低级别错误，例如缓冲区溢出、除零和空指针解引用。此外，它还保证功能正确性，即每个系统调用的实现都满足状态机规范。 定理2保证状态机规范与声明式规范相符。</p>
<p>需要注意的是，这两个定理并不保证内核初始化、粘合代码或生成的内核二进制的正确性。</p>
<h3 id="验证器">验证器</h3>
<p>验证器的任务是验证内核的正确性，这包括两个主要的正确性定理。</p>
<ol type="1">
<li><p><strong>内核行为建模：</strong> 验证器将内核的执行行为建模为一个状态机。在此模型中，状态迁移可以由陷阱处理或用户空间执行（不陷入内核）触发。Hyperkernel 中的陷阱处理是原子性的，这种原子性简化了验证过程，允许验证器独立地分析每个陷阱处理程序。</p></li>
<li><p><strong>原子性保证：</strong> 即使在单处理器系统中，为了确保陷阱处理程序的原子执行，Hyperkernel 需要处理来自I/O设备的并发问题，如中断和直接内存访问（DMA）。它通过禁用中断来实现原子性，延迟中断处理，直到执行返回用户空间。此外，为了隔离DMA的效果，内核将DMA限制在专用内存区域（称为DMA页面），并将这种隔离实现为在引导时配置的机制。DMA页面被视为易变的，读取DMA页面的内存将返回任意值。</p></li>
<li><p><strong>内核正确性的定义与验证：</strong> 内核的正确性以状态机refinement的形式定义。Z3验证器通过验证其否定是不可满足的来验证其正确性。如果找到反例，验证器会构建一个测试用例。</p></li>
</ol>
<p><img src="/Hyperkernel:Push-Button_Verification_of_an_OS_Kernel阅读/image5.png" width="600"></p>
<p><img src="/Hyperkernel:Push-Button_Verification_of_an_OS_Kernel阅读/image6.png" width="600"></p>
<ol start="4" type="1">
<li><p><strong>LLVM IR 的处理：</strong> 验证器将 LLVM IR 代码作为验证目标，通过符号执行来构建 SMT 表达式。它会处理 LLVM IR 中的未定义行为，并将 LLVM IR 中的指令映射到 SMT 表达式。对于易变内存访问（如 DMA 页面），验证器会生成适当的 SMT 表达式。验证器允许程序员提供内联汇编代码的抽象模型，以简化验证过程。这个模型是被信任而不是验证的，它通常用于模拟特定的硬件行为。</p></li>
<li><p><strong>编码交叉属性：</strong> 交叉属性是在声明性规范中定义的属性，它们描述了内核资源的管理方式和约束。这些属性通常包括：<br>
exclusive ownership：某些资源只能由一个对象独占拥有；<br>
reference-counted shared ownership：共享资源的引用计数必须与引用该资源的对象数量相匹配。<br><br> 对于exclusive ownership，如每个进程具有自己独立的地址空间，资源必须被独占拥有的属性，验证器采用以下编码方式: <br> 使用一个函数 <code>own</code>，将对象映射到它所拥有的资源；<br>
引入一个逆函数 <code>owned-by</code>，以确保每个资源只由一个对象拥有。<br><br> 对于reference-counted shared ownership，验证器需要确保资源的引用计数与引用该资源的对象数量相匹配。验证器使用以下编码方式：<br>
对于每个资源 <code>r</code>，引入一个排列函数 <code>π</code>，以对对象进行排序，使只有前 <code>refcnt(r)</code> 个对象引用资源 <code>r</code>。<br>
确保 <code>π</code> 是一个有效的排列，即存在逆函数 <code>π⁻¹</code>。</p></li>
</ol>
<h2 id="总结">总结</h2>
<ol type="1">
<li>设计了有限的内核接口，避免了无界的循环和递归，以适应SMT求解器的自动化验证。</li>
<li>使用硬件虚拟化技术简化了内核地址空间的管理，避免了对复杂的虚拟地址转换的建模。</li>
<li>在LLVM IR而不是源代码级别进行验证，减少了对C语言语义的建模工作。</li>
<li>提出了两级规范，包括状态机规范和更抽象的声明式规范，可以增强对规范正确性的信心。</li>
<li>使用SMT求解器Z3实现了对内核的自动化验证，包括验证实现满足规范和验证规范的一致性。</li>
</ol>

      </div>
    </div>
  </article>
  <div class="post__foot">
    
    <div class="post-nav">
  
    <a class="post-nav-item-left" href="/2023/09/05/zsh&oh-my-zsh/">
      <div class="text-align">
        <svg t="1670570876164"
             class="icon"
             viewBox="0 0 1024 1024"
             width="16"
             height="16">
          <path d="M384 512L731.733333 202.666667c17.066667-14.933333 19.2-42.666667 4.266667-59.733334-14.933333-17.066667-42.666667-19.2-59.733333-4.266666l-384 341.333333c-10.666667 8.533333-14.933333 19.2-14.933334 32s4.266667 23.466667 14.933334 32l384 341.333333c8.533333 6.4 19.2 10.666667 27.733333 10.666667 12.8 0 23.466667-4.266667 32-14.933333 14.933333-17.066667 14.933333-44.8-4.266667-59.733334L384 512z" p-id="14596"/>
        </svg>
        <span class="text-small">上一篇</span>
      </div>
      <div>zsh & oh-my-zsh 常用命令</div>
    </a>
  
  <div class="vhr"></div>
  
    <a class="post-nav-item-right" href="/2023/08/31/icns%E5%88%B6%E4%BD%9C/">
      <div class="text-align">
        <span class="text-small">下一篇</span>
        <svg t="1670570876164"
             class="icon"
             viewBox="0 0 1024 1024"
             transform="scale(-1,-1)"
             width="16"
             height="16">
          <path d="M384 512L731.733333 202.666667c17.066667-14.933333 19.2-42.666667 4.266667-59.733334-14.933333-17.066667-42.666667-19.2-59.733333-4.266666l-384 341.333333c-10.666667 8.533333-14.933333 19.2-14.933334 32s4.266667 23.466667 14.933334 32l384 341.333333c8.533333 6.4 19.2 10.666667 27.733333 10.666667 12.8 0 23.466667-4.266667 32-14.933333 14.933333-17.066667 14.933333-44.8-4.266667-59.733334L384 512z" p-id="14596"/>
        </svg>
      </div>
      icns 图标制作
    </a>
  
</div>

    
      <div class="related-post">
  <div class="related__head">
  <a href="/tags/Paper/" class="post-tag">#Paper</a><a href="/tags/Symbolic-Execution/" class="post-tag">#Symbolic Execution</a><a href="/tags/Staitc-Analysis/" class="post-tag">#Staitc Analysis</a><a href="/tags/SOSP/" class="post-tag">#SOSP</a><a href="/tags/xv6/" class="post-tag">#xv6</a><a href="/tags/SOSP-17/" class="post-tag">#SOSP'17</a>

</div>
  <div class="realated__body">
    
      <div class="null"><div class="null-item"><div class="null-title"><a href="/2023/08/31/Cross-checking_Semantic_Correctness:The_Case_of_Finding_File_System_Bugs阅读/" title="Cross-checking Semantic Correctness: The Case of Finding File System Bugs 阅读" rel="bookmark">Cross-checking Semantic Correctness: The Case of Finding File System Bugs 阅读</a></div></div><div class="null-item"><div class="null-title"><a href="/2023/10/23/Push-Button_Verification_of_File_Systems_via_Crash_Refinement阅读/" title="Push-Button Verification of File Systems via Crash Refinement 阅读" rel="bookmark">Push-Button Verification of File Systems via Crash Refinement 阅读</a></div></div><div class="null-item"><div class="null-title"><a href="/2023/09/18/Scaling_symbolic_evaluation_for_automated_verification_of_systems_code_with_Serval阅读/" title="Scaling symbolic evaluation for automated verification of systems code with Serval 阅读" rel="bookmark">Scaling symbolic evaluation for automated verification of systems code with Serval 阅读</a></div></div><div class="null-item"><div class="null-title"><a href="/2023/08/31/leetcode26.删除有序数组中的重复项/" title="leetcode 26. 删除有序数组中的重复项" rel="bookmark">leetcode 26. 删除有序数组中的重复项</a></div></div><div class="null-item"><div class="null-title"><a href="/2023/09/05/zsh&oh-my-zsh/" title="zsh & oh-my-zsh 常用命令" rel="bookmark">zsh & oh-my-zsh 常用命令</a></div></div></div>
    
  </div>
</div>

    
    
    
      <script src="https://utteranc.es/client.js"
    repo="jtzhpf/jtzhpf.github.io"
    issue-term="pathname"
    theme="github-light"
    crossorigin="anonymous"
    async>
</script>
    
  </div>

    </div>
    <div class="foot">
      <div class="foot-inner">
        <div class="foot__head">
          
            <div class="foot-line">
              
                <div class="matts">海</div>
              
                <div class="matts">内</div>
              
                <div class="matts">存</div>
              
                <div class="matts">知</div>
              
                <div class="matts">己</div>
              
            </div>
          
            <div class="foot-line">
              
                <div class="matts">天</div>
              
                <div class="matts">涯</div>
              
                <div class="matts">若</div>
              
                <div class="matts">比</div>
              
                <div class="matts">邻</div>
              
            </div>
          
        </div>
        <div class="foot__body">
          
          
            <div class="foot-item">
              <div class="foot-item__head">账号</div>
              <div class="foot-item__body">
                
                  <div class="text">
                    <img alt="link" height="20px" width="20px" src="/images/logo-github.svg"/>
                    <a class="foot-link" target="_blank" rel="noopener" href="https://github.com/jtzhpf">github</a>
                  </div>
                
              </div>
            </div>
          
          <div class="foot-item">
            <div class="foot-item__head">联系</div>
            <div class="foot-item__body">
              <div class="text">
                <img alt="link" height="20px" width="20px" src="/images/icon/icon-email.svg"/>
                <a class="foot-link" href="mailto:jtzhpf@126.com">jtzhpf@126.com</a>
              </div>
            </div>
          </div>
        </div>
        <div class="copyright">
          <a href="https://zpf.pages.dev">ZPF.SITE</a> &nbsp;|&nbsp;由&nbsp;<a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>&nbsp;及&nbsp;
          <svg width="20" height="20" viewBox="0 0 725 725">
            <path fill-rule="evenodd" fill="rgb(221, 221, 221)" d="M145.870,236.632 L396.955,103.578 L431.292,419.44 L156.600,522.53 L145.870,236.632 Z"/>
            <path fill-rule="evenodd" fill="rgb(159, 159, 159)" d="M396.955,103.578 L564.345,234.486 L611.558,513.469 L431.292,419.44 L396.955,103.578 Z"/>
            <path fill-rule="evenodd" fill="rgb(0, 0, 0)" d="M431.292,419.44 L611.558,513.469 L358.327,595.18 L156.600,522.53 L431.292,419.44 Z"/>
          </svg>
          <a target="_blank" rel="noopener" href="https://github.com/hooozen/hexo-theme-tranquility">致远</a>&nbsp;驱动
        </div>
      </div>
    </div>
    
    
    <script src="https://cdn.bootcdn.net/ajax/libs/mermaid/10.4.0/mermaid.min.js"></script>
    
    
  

  </body>
</html>