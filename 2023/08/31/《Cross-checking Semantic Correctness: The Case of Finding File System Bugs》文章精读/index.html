<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf8" />
    <meta name="viewport" content="initial-scale=1.0, width=device-width" />
    <title>
      
        《Cross-checking Semantic Correctness: The Case of Finding File System Bugs》文章精读 | ZPF.SITE
      
    </title>
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    
      <link rel="apple-touch-icon"
            sizes="180x180"
            href="/images/apple-touch-icon.png" />
    
    
      <link rel="icon"
            type="image/png"
            sizes="32x32"
            href="/images/favicon-32x32.png" />
    
    
      <link rel="icon"
            type="image/png"
            sizes="16x16"
            href="/images/favicon-16x16.png" />
    
    
      <link rel="mask-icon"
            href="/images/logo.svg"
            color="" />
    
    
    
      
  <style>
    @font-face {
        font-family:sourceHanSerif;
        src: url(/font/regular.ttf);
        font-weight: regular;
    }
  </style>

  <style>
    @font-face {
        font-family:sourceHanSerif;
        src: url(/font/bold.ttf);
        font-weight: bold;
    }
  </style>


    
    <link rel="stylesheet"
          type="text/css"
          href='/css/layout.css' />
    
    
  <link rel="stylesheet" type="text/css" href="/css/post.css" />
  

  <meta name="generator" content="Hexo 6.3.0"></head>
  <body>
    <div class="head">
      <div class="nav">
        <a href='/' class="nav-logo">
          <img alt="logo" height="60px" width="60px" src="/images/logo.svg" />
        </a>
        <input id="navBtn" type="checkbox" />
        <div class="nav-menu">
          
            
              <a class="nav-menu-item" href="/CS&Maths">Computer Science & Maths</a>
            
              <a class="nav-menu-item" href="/Life">Life</a>
            
          
        </div>
        <label class="nav-btn" for="navBtn"></label>
      </div>
    </div>
    <div class="body">
      
  <article class="post-content">
    <div class="post-inner--toc">
      <div class="post-content__head">
        <div class="post-title">《Cross-checking Semantic Correctness: The Case of Finding File System Bugs》文章精读</div>
        <div class="post-info">
          
  <a href="/tags/Linux/" class="post-tag">#Linux</a><a href="/tags/File-System/" class="post-tag">#File System</a><a href="/tags/%E8%AE%BA%E6%96%87/" class="post-tag">#论文</a><a href="/tags/Staitc-Analysis/" class="post-tag">#Staitc Analysis</a><a href="/tags/SOSP/" class="post-tag">#SOSP</a>


          <span class="post-date">2023-08-31</span>
        </div>
      </div>
      
        <aside class="toc-outer">
          <div class="toc-title">目录</div>
          <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E8%AE%BE%E8%AE%A1"><span class="post-toc-text">设计</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="post-toc-text">实现</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E9%97%AE%E9%A2%98"><span class="post-toc-text">问题</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%AE%9E%E9%AA%8C%E5%A4%8D%E7%8E%B0"><span class="post-toc-text">实验复现</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83"><span class="post-toc-text">实验环境</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%A4%8D%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="post-toc-text">复现步骤</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E4%B8%8B%E8%BD%BD-juxta"><span class="post-toc-text">下载 juxta</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E4%B8%8B%E8%BD%BD%E5%B9%B6%E6%B5%8B%E8%AF%95-linux"><span class="post-toc-text">下载并测试 Linux</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E7%BC%96%E8%AF%91-clang"><span class="post-toc-text">编译 clang</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%9E%84%E5%BB%BA-path-database"><span class="post-toc-text">构建 path database</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#code-checker"><span class="post-toc-text">code checker</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#get-sorted-results-of-checker-output"><span class="post-toc-text">get sorted results of checker output</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E7%BB%93%E6%9E%9C%E5%88%86%E6%9E%90"><span class="post-toc-text">结果分析</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%94%B9%E8%BF%9B"><span class="post-toc-text">改进</span></a></li></ol></li></ol>
          <a href="#" class="toc-top">回到顶部</a>
        </aside>
      
      <div class="post-content__body">
        
          <div class="post-gallery">
            
          </div>
        
        <p>主要思路是统计多个文件系统的实现，计算具体文件系统与多个文件系统总体之间的差异性（直方图/信息熵），从而窥探出其文件系统的具体实现在语义上的差异。 <span id="more"></span></p>
<h2 id="设计">设计</h2>
<figure>
<img src="/《Cross-checking%20Semantic%20Correctness:%20The%20Case%20of%20Finding%20File%20System%20Bugs》文章精读/image1.png" alt="" /><figcaption>Overview</figcaption>
</figure>
<ol type="1">
<li>To enable comparison, the source code of each file system is merged into one large file. This allows interprocedural analysis within a file system.</li>
<li>JUXTA collects execution information for each function in the file systems by constructing control-flow graphs (CFGs) and symbolically exploring these graphs from the entry point to the end of each function.</li>
<li>Symbols are canonicalized so that equivalent symbols have the same name across file systems. A path database that stores the extracted path information is also created, which allows applications like checkers and specification extractors to use the path information without reexecuting symbolic analysis. All of these facilitate comparison.</li>
<li>Symbolic execution is used to explore paths through functions and build a path database. The path info contains path conditions, return values, side effects, etc.</li>
<li>Two statistical methods are used to compare paths:
<ul>
<li>Histogram-based: Integer ranges are encoded into histograms and distances between histograms are computed.</li>
<li>Entropy-based: Used for <strong>events</strong> like flags or return value checks. Low non-zero entropy indicates a likely bug.（别的的实现均不包含这一event，则说明this event could be wrong implementation）</li>
</ul></li>
</ol>
<figure>
<img src="/《Cross-checking%20Semantic%20Correctness:%20The%20Case%20of%20Finding%20File%20System%20Bugs》文章精读/image2.png" alt="" /><figcaption>Histogram-based comparison</figcaption>
</figure>
<ol start="6" type="1">
<li>Bug reports are ranked to prioritize investigation of likely true positives. Metrics include histogram distance and entropy values.</li>
</ol>
<h2 id="实现">实现</h2>
<p>需要构建8个检查器：</p>
<ol type="1">
<li>返回值检查器：比较不同文件系统对同一VFS接口的返回值，找到返回值有明显差异的文件系统。</li>
<li>副作用检查器：比较同一VFS接口和返回值下的副作用，找到副作用有明显差异的文件系统。</li>
<li>函数调用检查器：比较同一VFS接口下的函数调用，找到调用函数有明显差异的文件系统。</li>
<li>路径条件检查器：比较同一VFS接口下的路径条件，找到路径条件有明显差异的文件系统。</li>
<li>提取文件系统规范：从不同文件系统中提取出共性行为作为潜在规范。</li>
<li>重构跨模块抽象：根据共性行为，可将其提升到VFS层，减少冗余。</li>
<li>推断锁语义：推断每个路径所持有和释放的锁，跟踪受锁保护的字段。</li>
<li>推断外部API语义：基于调用参数和返回值检查的频率分布，找出用法有明显差异的文件系统。</li>
</ol>
<h2 id="问题">问题</h2>
<ol type="1">
<li>依赖于大量实现相同功能的模块</li>
</ol>
<h2 id="实验复现">实验复现</h2>
<h3 id="实验环境">实验环境</h3>
<ul>
<li>docker ubuntu 14.04</li>
<li>gcc 4.8</li>
<li>g++ 4.8</li>
</ul>
<h3 id="复现步骤">复现步骤</h3>
<h4 id="下载-juxta">下载 juxta</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone https://github.com/sslab-gatech/juxta.git<br></code></pre></td></tr></table></figure>
<h4 id="下载并测试-linux">下载并测试 Linux</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone https://github.com/torvalds/linux.git<br>cd linux<br>git checkout v4.0-rc2<br>cp ../juxta/config/config-x86_64-full-fs-4.0 .config<br>make; make clean<br>cd ../juxta<br></code></pre></td></tr></table></figure>
<h4 id="编译-clang">编译 clang</h4>
<p>在编译 clang 之前在 juxta 的 <code>Makefile</code> 中增加<code>COMPILER := -DCMAKE_CXX_COMPILER=g++-4.8 -DCMAKE_C_COMPILER=gcc-4.8</code>，并且将其添加到 cmake 的参数中。 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">make clang-full   (first time only)<br>make clang        (from the next)<br></code></pre></td></tr></table></figure></p>
<h4 id="构建-path-database">构建 path database</h4>
<p>合并文件系统代码 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd analyzer<br>./ctrl.py merge_all  (for all file systems)<br>./ctrl.py merge ext4 (for ext4)<br></code></pre></td></tr></table></figure></p>
<p>对合并的文件系统代码静态分析 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">./ctrl.py clang_all  (for all file systems)<br>./ctrl.py clang ext4 (for ext4)<br></code></pre></td></tr></table></figure></p>
<p>构建路径数据库 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">./ctrl.py pickle_all (for all file systems)<br></code></pre></td></tr></table></figure></p>
<h4 id="code-checker">code checker</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">./ckrtn.py<br></code></pre></td></tr></table></figure>
<h4 id="get-sorted-results-of-checker-output">get sorted results of checker output</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">./catcklog.sh [checker output dir]<br></code></pre></td></tr></table></figure>
<h3 id="结果分析">结果分析</h3>
<p>TODO</p>
<h3 id="改进">改进</h3>
<p>TODO</p>

      </div>
    </div>
  </article>
  <div class="post__foot">
    
    <div class="post-nav">
  
    <a class="post-nav-item-left" href="/2023/08/31/icns%20%E5%88%B6%E4%BD%9C/">
      <div class="text-align">
        <svg t="1670570876164"
             class="icon"
             viewBox="0 0 1024 1024"
             width="16"
             height="16">
          <path d="M384 512L731.733333 202.666667c17.066667-14.933333 19.2-42.666667 4.266667-59.733334-14.933333-17.066667-42.666667-19.2-59.733333-4.266666l-384 341.333333c-10.666667 8.533333-14.933333 19.2-14.933334 32s4.266667 23.466667 14.933334 32l384 341.333333c8.533333 6.4 19.2 10.666667 27.733333 10.666667 12.8 0 23.466667-4.266667 32-14.933333 14.933333-17.066667 14.933333-44.8-4.266667-59.733334L384 512z" p-id="14596"/>
        </svg>
        <span class="text-small">上一篇</span>
      </div>
      <div>icns 图标制作</div>
    </a>
  
  <div class="vhr"></div>
  
    <a class="post-nav-item-right" href="/2023/08/31/%E5%B0%86Mac%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95%E5%A4%87%E4%BB%BD%E5%88%B0%E7%A7%BB%E5%8A%A8%E7%A1%AC%E7%9B%98%EF%BC%8C%E9%87%8A%E6%94%BEMac%E5%BE%AE%E4%BF%A1%E5%A4%87%E4%BB%BD%E5%8D%A0%E7%94%A8%E7%9A%84%E5%AD%98%E5%82%A8%E7%A9%BA%E9%97%B4/">
      <div class="text-align">
        <span class="text-small">下一篇</span>
        <svg t="1670570876164"
             class="icon"
             viewBox="0 0 1024 1024"
             transform="scale(-1,-1)"
             width="16"
             height="16">
          <path d="M384 512L731.733333 202.666667c17.066667-14.933333 19.2-42.666667 4.266667-59.733334-14.933333-17.066667-42.666667-19.2-59.733333-4.266666l-384 341.333333c-10.666667 8.533333-14.933333 19.2-14.933334 32s4.266667 23.466667 14.933334 32l384 341.333333c8.533333 6.4 19.2 10.666667 27.733333 10.666667 12.8 0 23.466667-4.266667 32-14.933333 14.933333-17.066667 14.933333-44.8-4.266667-59.733334L384 512z" p-id="14596"/>
        </svg>
      </div>
      将Mac微信聊天记录备份到移动硬盘，释放Mac微信备份占用的存储空间
    </a>
  
</div>

    
      <div class="related-post">
  <div class="related__head">
  <a href="/tags/Linux/" class="post-tag">#Linux</a><a href="/tags/File-System/" class="post-tag">#File System</a><a href="/tags/%E8%AE%BA%E6%96%87/" class="post-tag">#论文</a><a href="/tags/Staitc-Analysis/" class="post-tag">#Staitc Analysis</a><a href="/tags/SOSP/" class="post-tag">#SOSP</a>

</div>
  <div class="realated__body">
    
      <div class="null"><div class="null-item"><div class="null-title"><a href="/2023/09/06/《All File Systems Are Not Created Equal: On the Complexity of Crafting Crash-Consistent Applications》文章精读 /" title="《All File Systems Are Not Created Equal: On the Complexity of Crafting Crash-Consistent Applications》文章精读" rel="bookmark">《All File Systems Are Not Created Equal: On the Complexity of Crafting Crash-Consistent Applications》文章精读</a></div></div><div class="null-item"><div class="null-title"><a href="/2023/09/07/《SibylFS: formal specification and oracle-based testing for POSIX and real-world file systems》文章精读/" title="《SibylFS: formal specification and oracle-based testing for POSIX and real-world file systems》文章精读" rel="bookmark">《SibylFS: formal specification and oracle-based testing for POSIX and real-world file systems》文章精读</a></div></div><div class="null-item"><div class="null-title"><a href="/2023/09/03/《Hyperkernel: Push-Button Verification of an OS Kernel》文章精读/" title="《Hyperkernel: Push-Button Verification of an OS Kernel》文章精读" rel="bookmark">《Hyperkernel: Push-Button Verification of an OS Kernel》文章精读</a></div></div><div class="null-item"><div class="null-title"><a href="/2023/08/31/icns 制作/" title="icns 图标制作" rel="bookmark">icns 图标制作</a></div></div><div class="null-item"><div class="null-title"><a href="/2023/08/31/leetcode 26. 删除有序数组中的重复项/" title="leetcode 26. 删除有序数组中的重复项" rel="bookmark">leetcode 26. 删除有序数组中的重复项</a></div></div></div>
    
  </div>
</div>

    
    
  </div>

    </div>
    <div class="foot">
      <div class="foot-inner">
        <div class="foot__head">
          
            <div class="foot-line">
              <div class="matts">海</div><div class="matts">内</div><div class="matts">存</div><div class="matts">知</div><div class="matts">己</div>
            </div>
          
            <div class="foot-line">
              <div class="matts">天</div><div class="matts">涯</div><div class="matts">若</div><div class="matts">比</div><div class="matts">邻</div>
            </div>
          
        </div>
        <div class="foot__body">
          
          
            <div class="foot-item">
              <div class="foot-item__head">账号</div>
              <div class="foot-item__body">
                
                  <div class="text">
                    <img alt="link" height="20px" width="20px" src="/images/logo-github.svg" />
                    <a class="foot-link" target="_blank" rel="noopener" href="https://github.com/jtzhpf">github</a>
                  </div>
                
              </div>
            </div>
          
          <div class="foot-item">
            <div class="foot-item__head">联系</div>
            <div class="foot-item__body">
              <div class="text">
                <img alt="link" height="20px" width="20px" src="/images/icon/icon-email.svg" />
                <a class="foot-link" href="mailto:jtzhpf@126.com">jtzhpf@126.com</a>
              </div>
            </div>
          </div>
        </div>
        <div class="copyright">
          <a href="http://jtzhpf.github.io">ZPF.SITE</a> &nbsp;|&nbsp;由&nbsp;<a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>&nbsp;及&nbsp;
          <svg width="20" height="20" viewBox="0 0 725 725">
            <path fill-rule="evenodd" fill="rgb(221, 221, 221)" d="M145.870,236.632 L396.955,103.578 L431.292,419.44 L156.600,522.53 L145.870,236.632 Z" />
            <path fill-rule="evenodd" fill="rgb(159, 159, 159)" d="M396.955,103.578 L564.345,234.486 L611.558,513.469 L431.292,419.44 L396.955,103.578 Z" />
            <path fill-rule="evenodd" fill="rgb(0, 0, 0)" d="M431.292,419.44 L611.558,513.469 L358.327,595.18 L156.600,522.53 L431.292,419.44 Z" />
          </svg>
          <a target="_blank" rel="noopener" href="https://github.com/hooozen/hexo-theme-tranquility">致远</a>&nbsp;驱动
        </div>
      </div>
    </div>
    
    
  

  </body>
</html>
